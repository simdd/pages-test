(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5229:function(e,t,n){Promise.resolve().then(n.bind(n,9834))},9834:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var s=n(7437),l=n(2265),a=n(4887),r=n(5674);function i(){return(0,s.jsxs)("nav",{className:"w-full h-14 flex items-center justify-between px-4 bg-transparent shadow-none",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 font-bold text-lg",style:{color:"#222"},children:[(0,s.jsx)("span",{className:"inline-block align-middle",style:{width:28,height:28},children:(0,s.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"2",y:"2",width:"24",height:"24",rx:"7",fill:"#fff",stroke:"#222",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M9 9h10M9 14h7M9 19h10",stroke:"#222",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)("span",{children:"Chatbot"})]}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:(0,s.jsx)("a",{href:"https://github.com/tomcomtang/ai-chatbot-starter",target:"_blank",rel:"noopener noreferrer",className:"text-xl transition-all duration-200 hover:text-blue-600 hover:scale-110",style:{color:"#222"},children:(0,s.jsx)(r.hJX,{})})})]})}var o=n(6202);function c(e){let{message:t}=e;return"user"!==t.role?t.loading?(0,s.jsxs)("div",{className:"flex items-center justify-start mb-2 min-h-[48px]",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mr-2 flex items-center",children:(0,s.jsx)(r.iNY,{className:"text-2xl",style:{color:"#555"}})}),(0,s.jsxs)("div",{className:"flex items-center w-full",children:[(0,s.jsx)("span",{className:"animate-pulse text-base text-gray-900",children:"AI is thinking"}),(0,s.jsxs)("span",{className:"ml-1 inline-block w-4 h-4 align-middle",children:[(0,s.jsx)("span",{className:"inline-block w-1 h-1 bg-gray-400 rounded-full animate-bounce mr-0.5",style:{animationDelay:"0s"}}),(0,s.jsx)("span",{className:"inline-block w-1 h-1 bg-gray-400 rounded-full animate-bounce mr-0.5",style:{animationDelay:"0.15s"}}),(0,s.jsx)("span",{className:"inline-block w-1 h-1 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.3s"}})]})]})]}):(0,s.jsxs)("div",{className:"flex items-start justify-start mb-2",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mr-2 mt-1",children:(0,s.jsx)(r.iNY,{className:"text-2xl",style:{color:"#555"}})}),(0,s.jsxs)("div",{className:"flex flex-col w-full",children:[t.reasoning&&(0,s.jsxs)("div",{className:"border-l-4 border-gray-400 pl-3 mb-3",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-2",children:t.reasoning.includes("分析")||t.reasoning.includes("思考")?"分析过程：":"Analysis Process:"}),(0,s.jsxs)("div",{className:"prose prose-sm max-w-none text-gray-500",children:[(0,s.jsx)(o.UG,{children:t.reasoning}),(t.streamingReasoning||t.streaming&&t.reasoning&&!t.content)&&(0,s.jsx)("span",{className:"inline-block w-2 h-4 bg-gray-500 ml-1 animate-pulse",style:{animationDuration:"1s"}})]})]}),(0,s.jsxs)("div",{className:"prose prose-blue max-w-none text-base text-gray-900 mt-0 [&>*:first-child]:mt-0",children:[(0,s.jsx)(o.UG,{children:t.content}),(t.streamingContent||t.streaming&&t.content&&!t.reasoning)&&(0,s.jsx)("span",{className:"inline-block w-2 h-5 bg-gray-900 ml-1 animate-pulse",style:{animationDuration:"1s"}})]})]})]}):(0,s.jsxs)("div",{className:"flex items-center justify-end mb-2",children:[(0,s.jsxs)("div",{className:"relative max-w-[80%] flex items-center",children:[(0,s.jsx)("div",{className:"bg-[#f3f4f6] text-gray-900 px-4 py-2 rounded-[18px] shadow flex items-center min-h-[40px]",style:{lineHeight:"1.7"},children:(0,s.jsx)("div",{className:"user-message-markdown text-base text-gray-900 w-full",style:{display:"flex",alignItems:"center"},children:(0,s.jsx)(o.UG,{children:t.content})})}),(0,s.jsx)("svg",{className:"absolute right-[-10px] bottom-2",width:"16",height:"18",viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{zIndex:1},children:(0,s.jsx)("path",{d:"M0 18 Q8 2 16 8 Q10 12 0 18 Z",fill:"#f3f4f6"})})]}),(0,s.jsx)("div",{className:"flex-shrink-0 ml-4",children:(0,s.jsx)(r.m3W,{className:"text-2xl",style:{color:"#555"}})})]})}function d(e){let{messages:t}=e;return(0,s.jsx)("div",{className:"flex flex-col gap-4 py-4",children:t.map((e,t)=>(0,s.jsx)(c,{message:e},t))})}function u(e){let{value:t,onChange:n,borderless:a}=e,[r,i]=(0,l.useState)(!1),[o,c]=(0,l.useState)(-1),[d,u]=(0,l.useState)([]),[x,m]=(0,l.useState)(!0),h=(0,l.useRef)(null),f=(0,l.useRef)(null);(0,l.useEffect)(()=>{!async function(){try{let e=await fetch("/api/models",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),t=await e.json();u(t.models)}catch(e){console.error("Failed to fetch models:",e),u([{value:"deepseek-chat",label:"DeepSeek-V3",disabled:!1},{value:"deepseek-reasoner",label:"DeepSeek-R1",disabled:!1}])}finally{m(!1)}}()},[]);let g=d.find(e=>e.value===t)||d[0];function p(e){r&&("ArrowDown"===e.key?(c(e=>(e+1)%d.length),e.preventDefault()):"ArrowUp"===e.key?(c(e=>(e-1+d.length)%d.length),e.preventDefault()):"Enter"===e.key&&o>=0?(n(d[o].value),i(!1),c(-1)):"Escape"===e.key&&(i(!1),c(-1)))}return((0,l.useEffect)(()=>{r&&f.current&&f.current.focus()},[r]),(0,l.useEffect)(()=>{function e(e){h.current&&!h.current.contains(e.target)&&f.current&&!f.current.contains(e.target)&&(i(!1),c(-1))}function t(){c(-1)}return r&&(document.addEventListener("mousedown",e),f.current&&f.current.addEventListener("mouseleave",t)),()=>{document.removeEventListener("mousedown",e),f.current&&f.current.removeEventListener("mouseleave",t)}},[r]),x)?(0,s.jsx)("div",{className:"flex items-center gap-1 px-2 py-2 rounded bg-transparent text-gray-400 text-base ".concat(a?"":"border bg-gray-50"),children:(0,s.jsx)("span",{children:"Loading..."})}):(0,s.jsxs)("div",{className:"relative inline-flex align-middle select-none",tabIndex:-1,children:[(0,s.jsxs)("button",{ref:h,type:"button",className:"flex items-center gap-1 px-2 py-2 rounded bg-transparent text-gray-700 text-base focus:outline-none ".concat(a?"":"border bg-gray-50"),"aria-haspopup":"listbox","aria-expanded":r,onClick:()=>i(e=>!e),onKeyDown:p,children:[(0,s.jsx)("span",{children:(null==g?void 0:g.label)||"Select Model"}),(0,s.jsx)("svg",{width:"13",height:"13",viewBox:"0 0 20 20",fill:"none",className:"text-gray-400",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M6 8L10 12L14 8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),r&&(0,s.jsx)("ul",{ref:f,tabIndex:0,className:"absolute left-0 bottom-full mb-1 min-w-full bg-white border rounded-xl shadow-lg z-20 outline-none",role:"listbox",onKeyDown:p,children:d.map((e,l)=>(0,s.jsx)("li",{className:"px-4 py-2 text-base whitespace-nowrap transition-colors\n                ".concat(0===l?"rounded-t-xl":""," \n                ").concat(l===d.length-1?"rounded-b-xl":"","\n                ").concat(e.disabled?"text-gray-300 bg-white cursor-not-allowed":t===e.value?"bg-gray-100 text-black cursor-pointer":o===l?"bg-gray-100 text-gray-600 cursor-pointer":"bg-white text-gray-600 hover:bg-gray-100 hover:text-gray-600 cursor-pointer","\n              "),role:"option","aria-selected":t===e.value,"aria-disabled":e.disabled,onClick:()=>{e.disabled||(n(e.value),i(!1),c(-1))},onMouseEnter:()=>c(l),children:e.label},e.value))})]})}function x(e){let{onSend:t,isThinking:n,selectedModel:a,setSelectedModel:i,cardHeight:o=120}=e,[c,d]=(0,l.useState)(""),[x,m]=(0,l.useState)(!1),h=(0,l.useRef)(null),f=()=>{c.trim()&&!n&&(t(c),d(""),setTimeout(()=>{var e;null===(e=h.current)||void 0===e||e.focus()},0))};return(0,s.jsx)("div",{className:"fixed bottom-0 left-0 w-full bg-transparent border-t-0 z-10 flex justify-center pb-6 pointer-events-none",children:(0,s.jsxs)("div",{className:"w-full max-w-2xl flex flex-col gap-3 bg-white rounded-xl shadow-lg px-6 py-5 pointer-events-auto cursor-text transition-all duration-150 border border-[#e5e7eb]",style:x?{minHeight:o,marginBottom:"16px",border:"1.5px solid #d1d5db"}:{minHeight:o,marginBottom:"16px"},onClick:e=>{if(e.target===e.currentTarget){var t;null===(t=h.current)||void 0===t||t.focus()}},children:[(0,s.jsx)("textarea",{ref:h,className:"w-full resize-none rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-0 focus:border-none border-none shadow-none min-h-[48px] max-h-40 bg-transparent",placeholder:"Type your message...",value:c,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),f())},disabled:n,rows:2,onFocus:()=>m(!0),onBlur:()=>m(!1)}),(0,s.jsxs)("div",{className:"flex items-center justify-between w-full gap-2 mt-2",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(u,{value:a,onChange:i,borderless:!0})}),(0,s.jsx)("button",{className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-black text-white text-xl disabled:bg-gray-300 disabled:cursor-not-allowed shadow-md transition hover:bg-black focus:outline-none",onClick:f,disabled:n||!c.trim(),"aria-label":"Send",children:(0,s.jsx)(r.ZTc,{})})]})]})})}function m(e){let t=e.match(/\*\*分析过程：\*\*\s*\n([\s\S]*?)(?=\n\*\*回答：\*\*)/),n=e.match(/\*\*回答：\*\*\s*\n([\s\S]*)/);return t||(t=e.match(/\*\*Analysis Process:\*\*\s*\n([\s\S]*?)(?=\n\*\*Answer:\*\*)/),n=e.match(/\*\*Answer:\*\*\s*\n([\s\S]*)/)),{reasoning:t?t[1].trim():"",content:n?n[1].trim():e}}async function h(e,t,n,s){let l="",a="",r=new AbortController,i=setTimeout(()=>r.abort(),6e5);try{let t=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e,messages:n}),signal:r.signal});if(clearTimeout(i),!t.ok){let e="HTTP error! status: ".concat(t.status," ").concat(t.statusText);try{let n=await t.json();n.error&&(e=n.error)}catch(e){}throw Error(e)}let k=t.body.getReader(),S=new TextDecoder,C="";for(;;){let{done:e,value:t}=await k.read();if(e)break;let n=(C+=S.decode(t,{stream:!0})).split("\n");for(let e of(C=n.pop()||"",n))if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t){if(a)return s(l,a,!0),{aiContent:l,aiReasoning:a};{let{reasoning:e,content:t}=m(l);return s(t,e,!0),{aiContent:t,aiReasoning:e}}}try{var o,c,d,u,x,h,f,g,p,v,b,y,w,j,N;let e=JSON.parse(t),n="",r="";if("content_block_delta"===e.type&&(null===(o=e.delta)||void 0===o?void 0:o.type)==="text_delta"?n=e.delta.text:(null===(u=e.choices)||void 0===u?void 0:null===(d=u[0])||void 0===d?void 0:null===(c=d.delta)||void 0===c?void 0:c.reasoning_content)?r=e.choices[0].delta.reasoning_content:(null===(f=e.choices)||void 0===f?void 0:null===(h=f[0])||void 0===h?void 0:null===(x=h.delta)||void 0===x?void 0:x.content)&&a?n=e.choices[0].delta.content:(null===(v=e.choices)||void 0===v?void 0:null===(p=v[0])||void 0===p?void 0:null===(g=p.delta)||void 0===g?void 0:g.content)?n=e.choices[0].delta.content:(null===(N=e.candidates)||void 0===N?void 0:null===(j=N[0])||void 0===j?void 0:null===(w=j.content)||void 0===w?void 0:null===(y=w.parts)||void 0===y?void 0:null===(b=y[0])||void 0===b?void 0:b.text)&&(n=e.candidates[0].content.parts[0].text),n||r){if(r)a+=r,s(l,a,!1);else if(n){l+=n;let{reasoning:e,content:t}=m(l);s(t,e,!1)}}if("message_stop"===e.type){if(a)return s(l,a,!0),{aiContent:l,aiReasoning:a};{let{reasoning:e,content:t}=m(l);return s(t,e,!0),{aiContent:t,aiReasoning:e}}}}catch(e){console.warn("Failed to parse chunk:",t,e)}}}if(l||a){if(a)return s(l,a,!0),{aiContent:l,aiReasoning:a};{let{reasoning:e,content:t}=m(l);return s(t,e,!0),{aiContent:t,aiReasoning:e}}}}catch(e){throw console.error(e),clearTimeout(i),e}return{aiContent:l,aiReasoning:""}}function f(){let[e,t]=(0,l.useState)([]),[n,r]=(0,l.useState)(!1),[o,c]=(0,l.useState)("deepseek-chat"),[u,m]=(0,l.useState)([]),f=(0,l.useRef)(null),[g,p]=(0,l.useState)(!1),v=(0,l.useRef)(null),[b,y]=(0,l.useState)(!0),[w,j]=(0,l.useState)(!1),[N,k]=(0,l.useState)(""),[S,C]=(0,l.useState)(!1);(0,l.useEffect)(()=>{!async function(){try{let e=await fetch("/api/models",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),t=await e.json();m(t.models),!t.models.some(e=>e.value===o)&&t.models.length>0&&c(t.models[0].value)}catch(e){console.error("Failed to fetch available models:",e),m([{value:"deepseek-chat",label:"DeepSeek-V3",disabled:!1},{value:"deepseek-reasoner",label:"DeepSeek-R1",disabled:!1}])}}()},[o]);let E=(0,l.useCallback)(e=>{k(e),C(!0),setTimeout(()=>{C(!1)},5e3)},[]),T=(0,l.useCallback)(()=>{C(!1)},[]),D=()=>{var e;null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,l.useEffect)(()=>{D()},[e]),(0,l.useEffect)(()=>{let e=v.current;if(!e)return;let t=()=>{let{scrollTop:t,scrollHeight:n,clientHeight:s}=e;p(t+s<n-30)};return e.addEventListener("scroll",t),t(),()=>e.removeEventListener("scroll",t)},[e]);let L=(0,l.useCallback)((e,n,s)=>{(0,a.flushSync)(()=>{t(t=>{let l=t.findIndex(e=>e.loading);if(-1===l)for(l=t.length-1;l>=0&&"assistant"!==t[l].role;)l--;if(-1===l)return[...t,{role:"assistant",content:e,reasoning:n||"",streaming:!s}];let a=[...t];if(s)a[l]={role:"assistant",content:e,reasoning:n||""},r(!1);else{let t="deepseek-reasoner"===o,s=n&&n.length>0,r=e&&e.length>0;a[l]={role:"assistant",content:e,reasoning:n||"",streaming:!0,...t&&{streamingReasoning:s&&!r,streamingContent:r}}}return a})})},[]),M=async t=>{t.trim()&&!n&&(0===e.length&&b?(j(!0),setTimeout(()=>{y(!1),R(t)},300)):R(t))},R=async n=>{t(e=>[...e,{role:"user",content:n},{role:"assistant",content:"",thinking:"",loading:!0}]),r(!0),await new Promise(e=>setTimeout(e,0));let s=e.concat({role:"user",content:n}).filter(e=>!e.loading).map(e=>({role:e.role,content:e.content}));try{await h(o,n,s,L)}catch(e){t(e=>{let t=e.findIndex(e=>e.loading);if(-1===t)return e.map(e=>{if(e.loading){let{loading:t,...n}=e;return n}return e});let n=[...e];return n[t]={role:"assistant",content:"[Error contacting AI service]",reasoning:""},n.map(e=>{if(e.loading){let{loading:t,...n}=e;return n}return e})}),r(!1),E((null==e?void 0:e.message)||(null==e?void 0:e.toString())||"Unknown error")}},_=e.some(e=>e.streaming);return(0,s.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,s.jsx)(i,{}),S&&(0,s.jsx)("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 bg-red-500 text-white px-4 py-3 rounded-lg shadow-lg max-w-md",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,s.jsx)("span",{className:"text-sm",children:N})]}),(0,s.jsx)("button",{onClick:T,className:"ml-3 text-white hover:text-red-100 transition-colors","aria-label":"Close error message",children:(0,s.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden relative",children:[b&&(0,s.jsx)("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center transition-opacity duration-300 ".concat(w?"opacity-0 pointer-events-none":"opacity-100"),children:(0,s.jsxs)("div",{className:"w-full max-w-2xl flex-1 flex flex-col justify-center items-center",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center mb-24 select-none",children:[(0,s.jsx)("h1",{className:"text-5xl font-extrabold text-gray-900 mb-4 tracking-tight drop-shadow-sm text-center",children:"Multi-model AI Chatbot"}),(0,s.jsx)("p",{className:"text-lg text-gray-500 mb-2 text-center max-w-2xl",children:"Unlock new ways of thinking, creating, and working—AI empowers your ideas and accelerates your journey."})]}),(0,s.jsx)(x,{onSend:M,isThinking:n,selectedModel:o,setSelectedModel:c,cardHeight:120})]})}),(0,s.jsx)("div",{className:"flex-1 flex flex-col items-center justify-start transition-opacity duration-300 ".concat(b?"opacity-0 pointer-events-none":"opacity-100"),children:(!b||e.length>0)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{ref:v,className:"w-full flex-1 overflow-y-auto relative",style:{maxHeight:"calc(100vh - ".concat(176,"px)"),paddingBottom:"".concat(168,"px"),scrollbarGutter:"stable"},children:(0,s.jsxs)("div",{className:"w-full max-w-2xl mx-auto px-2",children:[(0,s.jsx)(d,{messages:e}),(0,s.jsx)("div",{ref:f,style:{scrollMarginBottom:"".concat(168,"px")}})]})}),!_&&g&&(0,s.jsx)("div",{className:"fixed left-0 w-full flex justify-center z-30 pointer-events-none",style:{bottom:"".concat(240,"px")},children:(0,s.jsx)("div",{className:"w-full max-w-2xl flex justify-center pointer-events-auto",children:(0,s.jsx)("button",{className:"scroll-to-bottom-btn rounded-full p-2",onClick:()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})},"aria-label":"Scroll to bottom",children:(0,s.jsx)("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M9 12l5 5 5-5",stroke:"#222",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})})}),(0,s.jsx)(x,{onSend:M,isThinking:n,selectedModel:o,setSelectedModel:c,cardHeight:120})]})})]})]})}}},function(e){e.O(0,[420,134,971,117,744],function(){return e(e.s=5229)}),_N_E=e.O()}]);